<!DOCTYPE html>
<html>
  <head>
    <title>Best practices for threadsafe Singletons - The Rootless Wanderer</title>
    <meta http-equiv="content-type" name="viewport" content="width=device-width, initial-scale=1.0, charset=utf-8">
    <link rel="stylesheet" href="/assets/css/github.css">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/assets/css/prettify.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Serif">
    <link rel="stylesheet" href="/assets/css/app.css">
    <style type="text/css">
      body { padding-top: 60px; padding-bottom: 40px; }
      
      /* Large desktop */
      @media (min-width: 1200px) {
          body { font-size:100%;}
          .wrap {max-width:770px;}
      }
      
      @media (max-width: 980px) {
         body {
            padding-top: 0px;
         }
      }
      
      /* Portrait tablet to landscape and desktop */
      @media (min-width: 768px) and (max-width: 979px) {
          body { font-size:95%;}
          h1 {
            font-size: 22pt;
          }
          h2 {
            font-size: 18pt;
          }
          h3 {
            font-size: 16pt;
          }
      }
      
      /* Landscape phone to portrait tablet */
      @media (max-width: 767px) {
          body { font-size:90%;}
          h1 {
            font-size: 20pt;
          }
          h2 {
            font-size: 16pt;
          }
          h3 {
            font-size: 14pt;
          }
      }
      
      /* Landscape phones and down */
      @media only screen and (max-width: 480px) {
          body { font-size:85%;}
          h1 {
            font-size: 18pt;
          }
          h2 {
            font-size: 14pt;
          }
          h3 {
            font-size: 12pt;
          }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="http://blog.sanjeevonline.com" class="brand">The Rootless Wanderer</a>
            <div class="nav-collapse collapse"><!-- .nav, .navbar-search, .navbar-form, etc -->
              <ul class="nav">
                <li><a href="/blog.html">Blog</a></li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Tags<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="/tag/agile.html">agile</a></li>
                    <li><a href="/tag/best-practices.html">best-practices</a></li>
                    <li><a href="/tag/eclipse.html">eclipse</a></li>
                    <li><a href="/tag/java.html">java</a></li>
                    <li><a href="/tag/nodejs.html">nodejs</a></li>
                    <li><a href="/tag/productivity.html">productivity</a></li>
                    <li><a href="/tag/travel.html">travel</a></li>
                    <li><a href="/tag/trivia.html">trivia</a></li>
                  </ul>
                </li>
                <li><a href="/archive.html">Archive</a></li>
              </ul>
            </div>
            <div class="pull-right nav-collapse collapse">
              <form id="search-form" action="http://www.google.com/search" method="get" class="navbar-search pull-left"><span class="glass js-search-action"><i></i></span>
                <input type="hidden" value="UTF-8" name="ie">
                <input type="hidden" value="UTF-8" name="oe">
                <input type="hidden" value="blog.sanjeevonline.com" name="domains">
                <input type="hidden" value="blog.sanjeevonline.com" name="sitesearch">
                <input name="q" type="text" placeholder="Search using Google..." class="search-query span2">
              </form>
            </div>
          </div>
        </div>
      </div>
      <article class="post shadow">
        <div>
          <h1>Best practices for threadsafe Singletons</h1>
          <footer class="footer">
            <div style="font-size: 13px" class="inner">
              <p class="pull-right"><a href="/blog.html" class="back"><< back to index</a></p>Posted by&nbsp;<span class="author"><a href="mailto:sanjeevonline@gmail.com">Sanjeev Kumar</a></span>|on&nbsp;<a href="/archive.html" class="back">January 15, 2011</a>|Tags :&nbsp;<a href="/tag/java.html" rel="category tag" title="View all posts in 'java'">java</a>&nbsp;<a href="/tag/best-practices.html" rel="category tag" title="View all posts in 'best-practices'">best-practices</a>&nbsp;
            </div>
          </footer>
        </div>
        <hr>
        <section class="content"><p>A singleton class should be designed to ensures that there exists only one instance per application. Special care must be taken if your application is deployed on a clustered environment as in this case it is possible that multiple instance of your singleton class are available in your application.   </p>
<p>Here are a few ways to create a thread safe singleton classes in your application. </p>
<p><span class="more"></span></p>
<h3>1. Lazy loading Singleton instance - Using Synchronized method or block</h3>

<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonClass</span>{</span>
    <span class="keyword">private</span> SingletonClass sc;
    <span class="keyword">private</span> SingletonClass(){}

        <span class="keyword">public</span> <span class="keyword">static</span> SingletonClass getInstance(){
        <span class="keyword">synchronized</span>(SingletonClass.class) {
          <span class="keyword">if</span> (sc == <span class="keyword">null</span>) {
              sc = <span class="keyword">new</span> SingletonClass();
          } <span class="keyword">else</span> {
             <span class="keyword">return</span> sc;
          }
        }
    }
}</code></pre>
<p><b>Issues</b>:    The use of synchronized keyword in a singleton class means that only one thread will be executing the synchronized block at a time and all other threads would be waiting.</p>
<h3>2. Early initialization Singleton - Using Static Member Variable</h3>

<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonClass</span>{</span>
    <span class="keyword">private</span> <span class="keyword">static</span> sc = <span class="keyword">new</span> SingletonClass();
    <span class="keyword">private</span> SingletonClass(){}

    <span class="keyword">public</span> <span class="keyword">static</span> SingletonClass getInstance(){
        <span class="keyword">return</span> sc;
    }
}</code></pre>
<p>This approach is also known as early initialization because we are creating the singleton instance at an early stage and not when the instance is actually needed by another class.</p>
<p><b>Issues</b>: The use of static member variable means that this singleton instance will be created as soon as the class is loaded by any Classloader in JVM. </p>
<h3>3. Singleton using Inner Classes</h3>

<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonClass</span>{</span>
    <span class="keyword">private</span> SingletonClass(){}
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span>{</span>
        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SingletonClass INSTANCE = <span class="keyword">new</span> SingletonClass(); 
    }
    <span class="keyword">public</span> <span class="keyword">static</span> SingletonClass getInstance(){
        <span class="keyword">return</span> InstanceHolder.INSTANCE; <span class="comment">//line1</span>
    }
}</code></pre>
<p>Here the instance is being created on demand and is also thread safe. The use of inner classes helps in the sense that the very first time singleton object is requested, the inner class is loaded by line1 and this loading of inner class causes the static member variable to be created and returned. Next time, the singleton member variable is requested causes the same static reference variable to be returned.</p>
<h3>4. Singleton using enums</h3>

<pre><code><span class="keyword">public</span> <span class="keyword">enum</span> Singleton{
    INSTANCE;
    <span class="keyword">private</span> <span class="keyword">int</span> a;
    <span class="keyword">public</span> <span class="keyword">int</span> getA() {
        <span class="keyword">return</span> a;
    }
}</code></pre>
<p>To get a single instance of this enum one should use:</p>
<pre><code><span class="filename">Singleton.INSTANCE</code></pre>
<p>To get the value of member variable a, one should use:</p>
<pre><code>Singleton<span class="preprocessor">.INSTANCE</span><span class="preprocessor">.getA</span>()<span class="comment">;</span></code></pre>
<p><b>In my experience using enums is the best way to implement Singleton design pattern in any Java application. It is thread safe and also provides lazy initialization.</b></p>
</section>
        <hr>
        <div id="social_bottom" class="topsocial">
          <div class="social"><a href="/articles/2011-01-15-Thread-Safe-Singletons/" data-url="http://blog.sanjeevonline.com/articles/2011-01-15-Thread-Safe-Singletons/" data-text="Best practices for threadsafe Singletons #java #best-practices /via @sandee_sh" data-count="vertical" class="twitter-share-button">
              <twitter-share-button></twitter-share-button></a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
          </div>
          <div class="social"><g:plusone size="tall" href="http://blog.sanjeevonline.com/articles/2011-01-15-Thread-Safe-Singletons/"></g:plusone></div>
          <div class="social">
            <script src="http://platform.linkedin.com/in.js" type="text/javascript"></script>
            <script type="IN/Share" data-url="http://blog.sanjeevonline.com/articles/2011-01-15-Thread-Safe-Singletons/" data-counter="top"></script>
          </div>
        </div>
        <hr>
        <h3>Similar Articles</h3>
        <table class="table table-striped">
          <tbody>
            <tr>
              <td><a href="/articles/2010-08-09-Composition-Inheritance/" title="java,best-practices">Prefer composition over inheritance</a></td>
            </tr>
            <tr>
              <td><a href="/articles/2010-08-29-Overiride-Carefully/" title="java,best-practices">Overridable methods need special care</a></td>
            </tr>
            <tr>
              <td><a href="/articles/2010-10-20-Beware-Of-Floating-Points/" title="java,best-practices">Beware of floating point numbers</a></td>
            </tr>
            <tr>
              <td><a href="/articles/2010-10-30-Package-By-Features/" title="best-practices,java">Package by feature not layer</a></td>
            </tr>
            <tr>
              <td><a href="/articles/2010-09-19-Use-Final-Liberally/" title="java,best-practices">Use final liberally. Please do.</a></td>
            </tr>
          </tbody>
        </table>
        <h4></h4>
        <div id="disqus_thread"></div><script type="text/javascript">
        var disqus_shortname = 'sanjeevonline';
        (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </article><hr />
      <footer class="footer">
        <div style="font-size: 13px" class="inner">
        </div>
      </footer>
    </div>
    <!--le javascript-->
    <!--script(src='http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js')-->
    <!--script(src= '#{locals.baseUrl}' + '/assets/javascript/jquery-twitter-plugin.js')-->
    <script src="/assets/javascript/jquery.min.js"></script>
    <script src="/assets/javascript/app.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-transition.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-alert.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-modal.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-scrollspy.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-tab.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-popover.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-button.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-collapse.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-carousel.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-typeahead.js"></script>
    <script src="/assets/bootstrap/js/bootstrap-dropdown.js"></script>
    <script src="http://platform.linkedin.com/in.js"></script><script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script>
    <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    |
       ga('create', 'UA-41222870-1', 'sanjeevonline.com');
       ga('send', 'pageview');
    |
    </script>
  </body>
</html>